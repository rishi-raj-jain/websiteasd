---
import Layout from "~/layouts/Layout.astro";
import { getCollection } from "astro:content";

export async function getStaticPaths() {
  const allPosts = await getCollection("posts");
  const allCategory = Array.from(
    new Set(allPosts.map((post) => post.data.category).flat()),
  );

  return allCategory.map((cat) => ({
    params: { id: cat },
    props: { id: cat, allPosts },
  }));
}

const { id, allPosts } = Astro.props;
const filteredPosts = allPosts.filter((post) =>
  post.data.category.includes(id),
);

console.log(filteredPosts);
---

<Layout>
  <div class="flex flex-col gap-20">
    <section class="flex flex-col gap-4">
      <h1 class="text-5xl">{id} 카테고리의 게시물</h1>
      <ul>
        {
          filteredPosts.map((post) => {
            return (
              <li>
                <a href={`/posts/${post.slug}`} class="hover:underline">
                  {post.data.title}
                </a>
              </li>
            );
          })
        }
      </ul>
    </section>
  </div>
</Layout>
